# Quick Test Config cho MSA Dataset
# Train nhanh với subset nhỏ để verify code hoạt động

system:
  device: 'cuda'      # Đổi thành 'cpu' nếu không có GPU
  seed: 42
  num_workers: 2

# MS Academic data
data:
  dataset_type: 'msa'
  data_dir: '../Query Reformulator'

# Legacy Word2Vec embeddings
embeddings:
  type: 'legacy'
  path: '../Query Reformulator/D_cbow_pdw_8B.pkl'
  embedding_dim: 500
  freeze: false

# Candidate Mining - GIẢM ĐỂ NHANH HƠN
candidate_mining:
  enabled: true
  max_candidates: 30           # Giảm từ 50 → 30
  min_score: 0.1
  methods:
    - 'tfidf'
  top_k_per_method: 20         # Giảm từ 30 → 20
  top_k_docs: 5                # Giảm từ 10 → 5 docs để mine

# RL Agent - GIẢM KÍ CH THƯỚC
rl_agent:
  enabled: true
  embedding_dim: 500
  hidden_dim: 128              # Giảm từ 256 → 128
  num_attention_heads: 2       # Giảm từ 4 → 2
  num_encoder_layers: 1        # Giảm từ 2 → 1
  dropout: 0.1
  max_steps_per_episode: 3     # Giảm từ 5 → 3 (ít từ được thêm)
  num_query_variants: 2        # Giảm từ 4 → 2 variants

  use_pretrained_embeddings: true
  embedding_type: 'legacy'

# RRF Fusion
rrf_fusion:
  enabled: true
  k_constant: 60
  method: 'rrf'

# BERT Re-ranker - TẮT ĐỂ NHANH HƠN
bert_reranker:
  enabled: false               # TẮT BERT để train nhanh
  model_name: 'cross-encoder/ms-marco-MiniLM-L-12-v2'
  batch_size: 64
  max_length: 256
  top_k_rerank: 50
  use_fp16: true

# Retrieval settings
retrieval:
  top_k: 50                    # Giảm từ 100 → 50
  bm25_k1: 0.9
  bm25_b: 0.4

# Training - AGGRESSIVE GIẢM
training:
  num_epochs: 10               # Chỉ 10 epochs thay vì 50
  batch_size: 16               # Giảm từ 32 → 16
  learning_rate: 0.0005        # Tăng LR để converge nhanh hơn
  episodes_per_update: 64      # Giảm từ 128 → 64
  ppo_epochs: 2                # Giảm từ 4 → 2
  gamma: 0.99
  gae_lambda: 0.95
  clip_epsilon: 0.2
  value_loss_coef: 0.5
  entropy_coef: 0.02           # Tăng exploration
  max_grad_norm: 0.5

  # Reward shaping
  reward_weights:
    recall: 0.7
    mrr: 0.3

  # Checkpointing
  checkpoint_dir: './checkpoints_msa_quick'
  save_freq: 2                 # Save mỗi 2 epochs

  # Early stopping
  early_stopping_patience: 5

  # Logging
  log_dir: './logs_msa_quick'

  # Replay buffer
  buffer_size: 5000            # Giảm từ 10000 → 5000

# Evaluation metrics
evaluation:
  metrics:
    - 'recall@10'
    - 'recall@20'
    - 'recall@40'
    - 'mrr@10'
    - 'ndcg@10'
