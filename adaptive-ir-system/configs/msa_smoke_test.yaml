# SMOKE TEST CONFIGURATION
# Mục tiêu: Chạy hết vòng Train -> Update -> Eval càng nhanh càng tốt

system:
  device: 'cuda'
  seed: 42
  num_workers: 0 # Tắt worker để debug dễ hơn

data:
  dataset_type: 'msa'
  data_dir: '../Query Reformulator'
  index_path: './data/msa_index'
  max_samples: 1000  # <--- CHỈ ĐỊNH 1000 SAMPLE TẠI ĐÂY

embeddings:
  type: 'legacy'
  path: '../Query Reformulator/D_cbow_pdw_8B.pkl'
  embedding_dim: 500
  freeze: true

candidate_mining:
  enabled: true
  max_candidates: 10   # Giảm cực thấp
  min_candidates: 2
  min_score: 0.0
  top_k0: 10
  methods: ['tfidf']   # Chạy 1 method thôi
  top_k_per_method: 10
  cache_enabled: false

rl_agent:
  enabled: true
  embedding_dim: 500
  hidden_dim: 64       # Model nhỏ
  num_heads: 1
  num_layers: 1
  max_steps_per_episode: 3
  num_query_variants: 2
  use_pretrained_embeddings: true
  embedding_type: 'legacy'
  
  # PPO
  learning_rate: 0.0001
  gamma: 0.99
  clip_epsilon: 0.2

rrf_fusion:
  enabled: true
  k_constant: 60
  method: 'rrf'

bert_reranker:
  enabled: true
  model_name: 'cross-encoder/ms-marco-MiniLM-L-6-v2'
  batch_size: 16
  max_length: 64
  top_k_rerank: 5
  use_fp16: true

retrieval:
  top_k: 20

training:
  num_epochs: 1
  
  # Batching - Cấu hình để update model cực nhanh
  batch_size: 8         # Batch tính toán gradient
  collect_batch_size: 8 # Batch thu thập dữ liệu
  episodes_per_update: 32 # Chỉ cần thu thập 32 mẫu là update model ngay -> nhảy vào Eval
  ppo_epochs: 2
  
  learning_rate: 0.0001
  use_amp: true
  
  buffer_size: 2000
  
  checkpoint_dir: './checkpoints_smoke'
  save_freq: 1   # Save mỗi epoch
  
  log_dir: './logs_smoke'
  log_freq: 1